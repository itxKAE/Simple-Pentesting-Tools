import socket
import time
import threading

from queue import Queue

# Set Default Timeout
socket.setdefaulttimeout(0.25)

# To Avoid Multiple Modification in One Iteration
print_lock = threading.Lock()

# User Inputs Target's IP
target = input("\nEnter the target's IP address: ")

# Resolves Given IP
target_ip = socket.gethostbyname(target)

# Port Scanning Function
print("Beginning Port Scan...\n")
def portscan(port):
   network_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
   try:
      connection = network_socket.connect((target_ip, port))
      with print_lock:
         print("Port", port, "is open")
      connection.close()
   except:
      pass

# Threading Function
def threader():
   while True:
      worker = queue.get()
      portscan(worker)
      queue.task_done()
queue = Queue()

# Process Start Time
start_time = time.time()

# Threading Processes
for x in range(100):
   t = threading.Thread(target = threader)
   t.daemon = True
   t.start()
for worker in range(1, 500):
   queue.put(worker)
queue.join()

# Output
print("\nPort Scan Completed!")
print("Time Taken:", time.time() - start_time, "seconds")