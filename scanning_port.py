import socket
import time
import threading

from queue import Queue

# Set Default Timeout
socket.setdefaulttimeout(0.25)

# To Avoid Multiple Modification in One Iteration
print_limit = threading.Lock()

# User Inputs Target
target = raw_input("\nEnter the Target: ") # Use 'input' for Windows

# Resolves Given IP
target_ip = socket.gethostbyname(target)

# Port Scanning Function
print("Beginning Port Scan...\n")
def portScan(port_num):
   network_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
   try:
      connection = network_socket.connect((target_ip, port_num))
      with print_limit:
	 # Checks for Well-Known Ports
	 if port_num == 20:
         	print("Port %s is Open (FTP)" % port_num)
	 elif port_num == 21:
         	print("Port %s is Open (FTP)" % port_num)
	 elif port_num == 22:
         	print("Port %s is Open (SSH)" % port_num)
	 elif port_num == 23:
         	print("Port %s is Open (Telnet)" % port_num)
	 elif port_num == 25:
         	print("Port %s is Open (SMTP)" % port_num)
	 elif port_num == 53:
         	print("Port %s is Open (DNS)" % port_num)
	 elif port_num == 69:
         	print("Port %s is Open (TFTP)" % port_num)
	 elif port_num == 80:
         	print("Port %s is Open (HTTP)" % port_num)
	 elif port_num == 110:
         	print("Port %s is Open (POP3)" % port_num)
	 elif port_num == 143:
         	print("Port %s is Open (IMAP4)" % port_num)
	 elif port_num == 443:
         	print("Port %s is Open (HTTPS)" % port_num)
 	 else:
         	print("Port %s is Open" % port_num)
      connection.close()
   except:
      pass

# Thread Function to Speed Up Processes
def theadFnc():
   while True:
      task = queue.get()
      portScan(task)
      queue.task_done()
queue = Queue()

# Process Start Time
start_time = time.time()

# Threading Processes
for x in range(100):
   threads = threading.Thread(target = theadFnc)
   threads.daemon = True
   threads.start()
for task in range(1, 500):
   queue.put(task)
queue.join()

# Output
print("\nPort Scan Completed!")
time_taken = time.time() - start_time
print("Time Taken: %s seconds\n" % time_taken)
